# Pupil size

## Material and Methods

### Pupil tracking

We tracked the pupil size and position from the mouse’s eye contralateral to the screen presentation. We used a USB camera (Flea3 FL3-U3-13Y3M, FLIR Integrated Imaging Solutions Inc.) equipped with a 10X lens (CFZOOM 13-130mm, Edmund Optics) and 780 nm long-pass filter (FGL780M, Thorlabs). The camera was positioned 20cm from the left side of the mouse’s face and was illuminated by 6 infrared LEDs. The visible light from the LCD monitor was sufficient to allow an appropriate dynamic range for state-dependent pupillary fluctuations (Neske et al., 2019). Video capture from the camera was controlled by custom-written *python* software (using the *simple_pyspin* API, see https://pypi.org/project/simple-pyspin/). Camera frames were 1280x680 pixels and acquired at a 30 Hz frame rate. To synchronize camera frames with other data acquired during the experiment, we stored digital time stamps in-between each frame acquisition. The time associated to a given frame for later analysis was then the center of the two surrounding time stamps. We estimated the pupil diameter from the frames using state-of-the-art processing (Reimer et al., 2014; McGinley et al 2015; Vinck et al., 2014, Neske et al., 2019, Stringer et al., 2019). Briefly, we restricted the image to a ROI corresponding to the animal's eye, we introduced a saturation level to get a nearly-binary image (below saturation corresponding to the pupil) and we fitted a 2D ellipse on this processed image (using the *minimize* function of *scipy.optimize*, 'Nelder-Mead' method). Blinking periods (<1% of recording time) were identified as outliers of the fitting procedures with the following criterion: blinking frames where the product of the fitted parameters and fit residuals exceeded 3 times the product of their standard deviation over the whole recording. Over such periods the pupil-related data (diameter and gaze direction) were linearly interpolated from the surrounding non-blinking periods.
